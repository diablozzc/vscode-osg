# VSCode OSG 扩展功能详解

本文档详细介绍 VSCode OSG 扩展的各项功能及使用方法。

## 🔍 定义跳转功能

定义跳转功能允许您快速导航到符号的定义位置，大大提升代码阅读和理解效率。

### 支持的跳转类型

#### 1. 节点类型定义跳转

**功能说明：** 从节点类型名称跳转到该节点在文档中的第一个定义位置。

**支持的节点类型：**
- `Group` - 组节点
- `Geode` - 几何节点  
- `MatrixTransform` - 矩阵变换节点
- `StateSet` - 状态集合
- `Material` - 材质对象
- `Texture2D` - 2D纹理
- `Geometry` - 几何体
- `LOD` - 细节层次节点
- `PagedLOD` - 分页细节层次节点
- 以及更多...

**使用方法：**
1. 将光标放在任何节点类型名称上（如 `Group`、`Geode` 等）
2. 按 `F12` 键或右键选择"转到定义"
3. 编辑器将跳转到该节点类型在文档中的第一个定义位置

**示例：**
```osg
Group {                    # <- 定义位置
    UniqueID MainGroup
    num_children 2
    
    Group {                # <- 从这里按F12会跳转到上面的第一个Group
        UniqueID SubGroup
    }
}
```

#### 2. 属性定义跳转

**功能说明：** 从属性名称跳转到该属性在文档中的第一个定义位置。

**支持的属性：**
- `nodeMask` - 节点掩码
- `DataVariance` - 数据变化性
- `cullingActive` - 裁剪激活
- `ambientColor` - 环境光颜色
- `diffuseColor` - 漫射光颜色
- `Matrix` - 变换矩阵
- 以及更多...

**使用方法：**
1. 将光标放在任何属性名称上
2. 按 `F12` 键或右键选择"转到定义"
3. 跳转到该属性在文档中的第一个使用位置

**示例：**
```osg
Group {
    nodeMask 0xffffffff    # <- 定义位置
    
    Geode {
        nodeMask 0xffffffff # <- 从这里按F12会跳转到上面的第一个nodeMask
    }
}
```

#### 3. UniqueID 引用跳转

**功能说明：** 从 UniqueID 的引用跳转到其定义位置。

**使用方法：**
1. 将光标放在 UniqueID 值上（如 `TestGroup_0`）
2. 按 `F12` 键或右键选择"转到定义"
3. 跳转到该 UniqueID 的定义行

**示例：**
```osg
Group {
    UniqueID TestGroup_0   # <- 定义位置
}

# 在其他地方引用时
# Reference to TestGroup_0  <- 从这里按F12会跳转到上面的定义
```

#### 4. 文件引用跳转

**功能说明：** 从文件路径引用跳转到实际文件。

**支持的文件类型：**
- 纹理文件：`.jpg`, `.png`, `.bmp`, `.tga`, `.dds`, `.tif`, `.tiff`
- OSG 文件：`.osg`, `.ive`, `.osgb`

**使用方法：**
1. 将光标放在文件路径上（通常在引号内）
2. 按 `F12` 键或右键选择"转到定义"
3. 如果文件存在，将打开该文件

**示例：**
```osg
Texture2D {
    file "textures/wood.jpg"  # <- 按F12会尝试打开这个文件
}
```

**文件查找路径：**
扩展会在以下路径中查找文件：
1. 当前文件所在目录
2. 上级目录
3. `textures/` 子目录
4. `models/` 子目录

## 📍 引用查找功能

引用查找功能帮助您找到符号在整个项目中的所有使用位置，便于代码重构和维护。

### 支持的查找类型

#### 1. 节点类型引用查找

**功能说明：** 查找节点类型在当前文档和工作区中的所有使用位置。

**使用方法：**
1. 将光标放在节点类型名称上
2. 按 `Shift+F12` 键或右键选择"查找所有引用"
3. 在引用面板中查看所有使用位置

**示例结果：**
```
Group (5 个引用)
├─ example.osg:1:1 - Group {
├─ example.osg:8:5 - Group {
├─ example.osg:15:5 - Group {
├─ test.osg:3:1 - Group {
└─ test.osg:20:9 - Group {
```

#### 2. 属性引用查找

**功能说明：** 查找属性在项目中的所有使用位置。

**使用方法：**
1. 将光标放在属性名称上
2. 按 `Shift+F12` 键或右键选择"查找所有引用"
3. 查看该属性在项目中的所有使用位置

#### 3. UniqueID 引用查找

**功能说明：** 查找 UniqueID 的定义和所有引用位置。

**使用方法：**
1. 将光标放在 UniqueID 值上
2. 按 `Shift+F12` 键或右键选择"查找所有引用"
3. 查看该 ID 的定义和所有引用位置

#### 4. 文件引用查找

**功能说明：** 查找文件在项目中被引用的所有位置。

**使用方法：**
1. 将光标放在文件名上
2. 按 `Shift+F12` 键或右键选择"查找所有引用"
3. 查看该文件在项目中的所有引用位置

### 引用查找选项

**包含声明：** 在查找结果中是否包含符号的定义位置
- 默认情况下会包含定义位置
- 可以通过设置控制是否显示定义

**跨文件查找：** 支持在整个工作区中查找引用
- 自动扫描所有 `.osg` 文件
- 排除 `node_modules` 等无关目录
- 支持大型项目的快速查找

## 🚀 使用技巧

### 键盘快捷键

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 转到定义 | `F12` | 跳转到符号定义位置 |
| 查找所有引用 | `Shift+F12` | 显示所有引用位置 |
| 返回上一位置 | `Ctrl+-` (Windows) / `Cmd+-` (Mac) | 跳转后返回原位置 |

### 右键菜单

在任何符号上右键，可以看到以下选项：
- **转到定义** - 跳转到定义位置
- **查找所有引用** - 显示所有引用
- **重命名符号** - 重命名符号（如果支持）

### 最佳实践

1. **使用有意义的 UniqueID**
   ```osg
   # 好的命名
   Group {
       UniqueID MainSceneRoot
   }
   
   # 避免无意义的命名
   Group {
       UniqueID Group_1
   }
   ```

2. **组织文件结构**
   ```
   project/
   ├─ models/
   │  ├─ building.osg
   │  └─ vehicle.osg
   ├─ textures/
   │  ├─ brick.jpg
   │  └─ metal.png
   └─ scenes/
      └─ main.osg
   ```

3. **使用相对路径**
   ```osg
   Texture2D {
       file "../textures/brick.jpg"  # 相对路径，便于项目移植
   }
   ```

## 🔧 故障排除

### 定义跳转不工作

**可能原因：**
1. 符号不在已知的 OSG 类型列表中
2. 文件路径不正确
3. 光标位置不准确

**解决方法：**
1. 确保光标准确放在符号名称上
2. 检查文件路径是否存在
3. 确认符号是否为标准 OSG 类型

### 引用查找结果不完整

**可能原因：**
1. 工作区中存在无法读取的文件
2. 符号命名不规范
3. 文件编码问题

**解决方法：**
1. 检查文件权限和编码
2. 确保所有 OSG 文件都使用 UTF-8 编码
3. 重启 VS Code 刷新索引

### 性能问题

**优化建议：**
1. 排除不必要的目录（在 `.gitignore` 中添加）
2. 关闭不必要的文件监视
3. 对于大型项目，考虑分模块组织

## 📚 参考资料

- [OpenSceneGraph 官方文档](http://www.openscenegraph.org/)
- [OSG 文件格式规范](http://www.openscenegraph.org/documentation/osg_file_format.html)
- [VS Code 语言扩展开发指南](https://code.visualstudio.com/api/language-extensions/overview) 